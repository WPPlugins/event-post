
jQuery(window).load(function(){if(typeof ol!=="undefined"){ep_maps=[];ep_vectorSources=[];ep_pop_elements=[];ep_popups=[];ep_icons=[];ep_proj_source=new ol.proj.Projection({code:"EPSG:4326"});ep_proj_destination=new ol.proj.Projection({code:"EPSG:900913"});ep_interactions=eventpost_params.map_interactions;ep_retina=(window.retina||window.devicePixelRatio>1.5);function b(c){return(eventpost_params.maptiles[c]["urls_retina"]&&ep_retina)}jQuery("a.event_link.gps").click(function(){if(jQuery(this).parent().data("latitude")!==undefined&&jQuery(this).parent().data("longitude")!==undefined){var g=jQuery(this).parent().data("latitude");var h=jQuery(this).parent().data("longitude");var e=jQuery(this).parent().data("marker");var i=jQuery(this).parent().data("id");var d="event_map"+i;var c=new ol.proj.transform([h,g],ep_proj_source,ep_proj_destination);if(jQuery("#"+d).length===0){jQuery(this).parent().append('<div id="'+d+'-wrap"><div id="'+d+'" class="event_map"></div></div>');jQuery("#"+d+"-wrap").css({height:"400px",margin:"auto",clear:"both"}).animate({height:"toggle"},1);ep_vectorSources[d]=new ol.source.Vector();ep_maps[d]=new ol.Map({target:d,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:(b(eventpost_params.defaulttile)?eventpost_params.maptiles[eventpost_params.defaulttile]["urls_retina"]:eventpost_params.maptiles[eventpost_params.defaulttile]["urls"]),tilePixelRatio:(b(eventpost_params.defaulttile)?2:1),attribution:eventpost_params.maptiles[eventpost_params.defaulttile]["attribution"]})}),new ol.layer.Vector({source:ep_vectorSources[d]})],view:new ol.View({center:c,zoom:eventpost_params.zoom})});ep_maps[d].addControl(new ol.control.Zoom());var f=new ol.Feature({geometry:new ol.geom.Point(c)});if(ep_icons[e]===undefined){ep_icons[e]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:e}))})}f.setStyle(ep_icons[e]);ep_vectorSources[d].addFeature(f)}jQuery("#"+d+"-wrap").animate({height:"toggle"},1000,function(){ep_maps[d].getView().setCenter(c)});return false}});jQuery(".event_geolist").each(function(){var g=jQuery(this).attr("id");var e="event_map_all"+g;var i="event_markersall"+g;var c=jQuery(this).data("width");var j=jQuery(this).data("height");var k=jQuery(this).data("zoom");var h=jQuery(this).data("tile");if(h===""){h=eventpost_params.defaulttile}var d=jQuery(this).data("disabled-interactions");jQuery(this).addClass("event_geolist_parsed").append('<div id="'+e+'" class="event_map map"></div><div id="'+e+'-popup" class="event_map_popup"></div>');css={margin:"auto",clear:"both"};if(c!=="auto"){css.width=c}if(j!=="auto"){css.height=j}jQuery("#"+e).css(css);ep_vectorSources[e]=new ol.source.Vector();ep_pop_elements[e]=document.getElementById(e+"-popup");ep_popups[e]=new ol.Overlay({element:ep_pop_elements[e],positioning:"bottom-center",stopEvent:false});map_settings={target:e,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:(b(h)?eventpost_params.maptiles[h]["urls_retina"]:eventpost_params.maptiles[h]["urls"]),tilePixelRatio:(b(h)?2:1),attribution:eventpost_params.maptiles[h]["attribution"]})}),new ol.layer.Vector({source:ep_vectorSources[e]})],view:new ol.View({center:[0,0],zoom:isNaN(k)?12:k,maxZoom:18}),overlays:[ep_popups[e]]};ep_maps[e]=new ol.Map(map_settings);ep_maps[e].addControl(new ol.control.ZoomSlider());ep_maps[e].on("click",function(l){var m=ep_maps[e].forEachFeatureAtPixel(l.pixel,function(r,q){return r});if(m){jQuery(ep_pop_elements[e]).hide(0);view=ep_maps[e].getView();var o=m.getGeometry();var p=o.getCoordinates();var n=ol.animation.pan({duration:1000,source:view.getCenter()});ep_maps[e].beforeRender(n);view.setCenter(p);ep_popups[e].setPosition(p);html_output='<a href="'+m.get("link")+'">'+(m.get("thumbnail")!==""&&m.get("thumbnail")!==undefined?'<img src="'+m.get("thumbnail")+'">':"")+"<strong>"+m.get("name")+"</strong><br><time>"+m.get("date")+"</time><br><address>"+m.get("address")+"</address>"+(m.get("desc")!==""&&m.get("desc")!==undefined?"<p>"+m.get("desc")+"</p>":"")+"</a>";jQuery(ep_pop_elements[e]).delay(500).html(html_output).show(500)}else{jQuery(ep_pop_elements[e]).hide(200)}});jQuery(this).find("address").each(function(){var o=parseFloat(jQuery(this).data("latitude"));var p=parseFloat(jQuery(this).data("longitude"));if(o!==undefined&&p!==undefined){var m=jQuery(this).parent().parent();var l=jQuery(this).data("marker");var q=jQuery(this).data("id");coords=new ol.proj.transform([p,o],ep_proj_source,ep_proj_destination);obj={geometry:new ol.geom.Point(coords),name:m.find("h5").text(),address:jQuery(this).html(),date:m.find("time").text(),link:m.find("a").attr("href"),desc:m.find(".event_exerpt").html()};if(m.find("img").length>0){obj.thumbnail=m.find("img").attr("src")}var n=new ol.Feature(obj);if(ep_icons[l]===undefined){ep_icons[l]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:l}))})}n.setStyle(ep_icons[l]);ep_vectorSources[e].addFeature(n)}});ep_maps[e].getView().fit(ep_vectorSources[e].getExtent(),ep_maps[e].getSize());if(!isNaN(k)&&k!==""&&k>0){ep_maps[e].getView().setZoom(k)}m_i=0;var f;for(f in ep_interactions){if(d.indexOf(f+",")>-1){ep_maps[e].getInteractions().getArray()[m_i].setActive(false)}m_i++}})}else{jQuery(".event_geolist").hide()}function a(){jQuery(".eventpost_cal_bt").click(function(){var c=jQuery(this).parents(".eventpost_calendar");jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:c.data("cat"),mf:c.data("mf"),dp:c.data("dp"),color:c.data("color"),thumbnail:c.data("thumbnail")},function(d){c.html(d);a()})});jQuery(".eventpost_cal_link").click(function(){var c=jQuery(this).parents(".eventpost_calendar");jQuery(".eventpost_cal_list",c).fadeOut(function(){jQuery(this).remove()});jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendarDate",date:jQuery(this).data("date"),cat:c.data("cat"),mf:c.data("mf"),dp:c.data("dp"),color:c.data("color"),thumbnail:c.data("thumbnail")},function(d){c.append('<div class="eventpost_cal_list"><button class="eventpost_cal_close">x</button>'+d+"</div>");c.find(".eventpost_cal_list").hide(1).fadeIn(500);c.find(".eventpost_cal_close").click(function(){jQuery(this).parent().hide(500).remove()})})})}jQuery(".eventpost_calendar").each(function(){var c=jQuery(this);c.html('<img src="'+eventpost_params.imgpath+'cal-loader.gif" class="eventpost_cal_loader"/>');jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:jQuery(this).data("cat"),mf:jQuery(this).data("mf"),dp:jQuery(this).data("dp"),color:jQuery(this).data("color"),thumbnail:jQuery(this).data("thumbnail")},function(d){c.html(d);a()})})});